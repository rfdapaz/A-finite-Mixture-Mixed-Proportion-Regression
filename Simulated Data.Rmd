---
title: 'A finite Mixture Mixed Proportion Regression Model for Classification Problems in Longitudinal Voting data'
Autor: ' '
output:
  html_document:
    df_print: paged
---



The aim of this work is to present the scripts for implement the methodology presented in the manuscript: A finite Mixture Mixed Proportion Regression Model for Classification Problems in Longitudinal Voting data.
This work is the result of a partnership between the Federal University of Ceará ( Laboratory of Innovative Technologies from portuguese, LTI, <https://dmontier.pro.br/lti/>), Instituto de Ciências Matemáticas e de Computação, Universidade de São Paulo, both in Brazil, and University of Connecticut, Storrs, USA.


Autors: Rosineide da Paz, Jorge Luis Bazán, Victor Hugo Lachos and Dipak Dey


The methodology is implemented in real and simulated data set. Here we present the code for simulate the data used in the manuscript.


### Packages requerid for simulation


if(!require(truncnorm)) install.packages("truncnorm");require(truncnorm) 
if(!require(MASS)) install.packages("MASS");require(MASS) 
if(!require(llogistic)) install.packages("llogistic");require(llogistic) 
if(!require(MCMCpack)) install.packages("MCMCpack");require(MCMCpack) 
if(!require(mvtnorm)) install.packages("mvtnorm");require(mvtnorm)
if(!require(LaplacesDemon)) install.packages("LaplacesDemon");require(LaplacesDemon)


```{r include=FALSE}
if(!require(truncnorm)) install.packages("truncnorm");require(truncnorm) 
if(!require(MASS)) install.packages("MASS");require(MASS) 
if(!require(llogistic)) install.packages("llogistic");require(llogistic) 
if(!require(MCMCpack)) install.packages("MCMCpack");require(MCMCpack) 
if(!require(mvtnorm)) install.packages("mvtnorm");require(mvtnorm)
if(!require(LaplacesDemon)) install.packages("LaplacesDemon");require(LaplacesDemon)

```







####  Simulated data from a mixture of regression model with two components



```{r}
m=100         # number of individuals 
Tp=5          # number of replication for each unit sample
n=m*Tp        # total of observations
k=2           # number of compontent in the mixture
grau=2        # degree of polynomial used in the analysis
pcov=grau+1   # number of parameter for fixe effect
seed=2005     # seed used in the simulation
w=c(0.4,0.6)  # Mixture weights for two components
```



####  Taking orthogonal polynomial for model matrix (X)

```{r}
Vt=rep(1:Tp,m)
X=model.matrix(~poly(Vt, degree=grau))
cc=ncol(X)
X=matrix(X,n,cc)
```


####  Explanatory variable for random-effects

```{r}
Z1=X[1:Tp,]
Z=diag(m)%x%Z1 
Zi=Xi=Z1
```


#### Function for simulating indicator variables from a discrete distribution

```{r}
rDiscreta<-function(p){
 u<-runif(1)
 P<-cumsum(p)
 val<-sum(P<u)+1
 val}
#
set.seed(seed)
pgrupos<-w
Sverd<-numeric(m)
indiv<-NULL
Y<-NULL
for (i in 1:m){
	Sverd[i]<-rDiscreta(pgrupos)
}
```


#### Regression coefficints for  fixed-effect 


```{r}
t=rep(seq(1:Tp),m)
           
set.seed(seed)
btamix=rbind( c(1.20,3.5, 3.8,  2.50),
              c( -0.5, -6.5, -5.5, 2.2),
              c( -2.50, 2.0, 6.5,  3.2))  
              
 betamix=cbind(btamix[,1:cc],btamix[,length(btamix[1,])]         )  
 thetamix=cbind(btamix[1:k,],w)         
 s=c(t(matrix(rep(Sverd,Tp),m,Tp)) )        
 betamix=betamix[s,]
 ind=c(t(matrix(rep(seq(1:m),Tp),m,Tp)) )
```


#### To simulate random-effects 

```{r}
npbi=ncol(Z1)
mu=rep(0,npbi) 
set.seed(seed)
Sigmab=solve(diag(length(mu))+2*runif(npbi))
b=mvrnorm(m, mu, Sigmab)
b=c(t(b))
```




#### Genarating a mixed mixture regression  with 3 components

```{r}
y_sim=numeric()
for(i in 1:n){
eta=X[i,]%*%betamix[i,1:pcov]+Z[i,]%*%as.matrix(b)    ### preditor linear do modelo misto para o individuo i
med=exp(eta)/(1+exp(eta))
ph=exp(betamix[i,(pcov+1)])
y=rllogistic(1 , med, ph)     #### amsotra gerada sem mistura
y_sim=rbind(y_sim,y)
}   

par(mfrow=c(1,2))
y=y_sim
y_sim=t(matrix(y,Tp,m))
 ano=c(1,2,3,4,5)
y_sim=t(matrix(y,Tp,m))
plot(ano,y_sim[1,], type="l",ylim=c(0,1),main="Real Classification", ylab=" Proportion",
 xlab="Point at time",xaxt='n')
for(i in 2:m){
lines(ano,y_sim[i,],col=Sverd[i], type="o",  lty=Sverd[i])

}
axis(1, at=ano,labels=ano, col.axis="black", las=1)

 

```






